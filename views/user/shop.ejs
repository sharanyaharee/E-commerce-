<html>
  <%- include('../partials/header.ejs')%>
  <style>
   #searchSuggestions {
    position: absolute;
  z-index: 1000;
  width: 200px;
  max-height: 200px;
  overflow-y: auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  background-color: #e0e6ec;

}

#searchSuggestions div {
  padding: 10px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#searchSuggestions div:hover {
  background-color: #6c757d;
}


  </style>
  <main class="mx-5">
    <div class="breadcrumb-option">
      <div class="container-fluid">
        <div class="row">
          <div class="col-lg-12">
            <div class="breadcrumb__links">
              <a href="/"><i class="fa fa-home"></i> Home</a>
              <span>Shop</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="shop spad">
      <div class="container-fluid">
        <div class="row">
          <div class="col-lg-3 col-md-3">
            <div class="sidebar-toggle mx-0">
              <button onclick="toggleSidebar()">
                <i class="fa fa-bars"></i>
              </button>
            </div>
            <div class="shop__sidebar">
              

              <form id="searchForm" action="/search" method="GET">
                <input
                  type="search"
                  id="search"
                  name="term"
                  style="
                    width: 200px;
                    height: 43px;
                  "
                   autocomplete="off"
                  placeholder="Search Products"
                />
                <input type="hidden" name="sortOrder" id="sortOrder" value="<%= sortOrder %>" />
                <!-- End of hidden input field -->
                <div id="searchSuggestions"></div>
              </form>
              
           <div class="sidebar__categories">
                <div class="section-title">
                  <h4>Categories</h4>
                </div>
                <div class="categories__accordion">
                  <div class="categories__accordion">
                    <div class="accordion" id="accordionExample">
                      <% categories.forEach((category) => { %>
                      <div class="card">
                        <div class="card-heading">
                          <a href="/shop/<%= category._id %>"
                            ><%= category.name %></a
                          >
                        </div>
                      </div>
                      <% }); %>
                    </div>
                  </div>
                </div>
              </div>
             
              <div class="sidebar__sizes">
                <div class="section-title">
                  <h4>Sort the price</h4>
                </div>
                <div class="size__list">
                  <% if(catId){%>
                  <ul style="list-style-type: none">
                    <li>    
                     
                      <a style="text-decoration: none; color: black" href="/shop/<%= catId %>?page=1&sortOrder=lowToHigh&term=<%= searchTerm %>">
                        Low to High
                      </a>
                    </li>
                    <li>
                      <a style="text-decoration: none; color: black" href="/shop/<%= catId %>?page=1&sortOrder=highToLow&term=<%= searchTerm %>">
                        High to Low
                      </a>
                    </li>
                  </ul>
                  <%}else{%>
                    <ul style="list-style-type: none">
                      <li>    
                       
                        <a style="text-decoration: none; color: black" href="/search?term=<%= searchTerm %>&page=1&sortOrder=lowToHigh">
                          Low to High
                      </a>
                      </li>
                      <li>
                      
                        <a style="text-decoration: none; color: black" href="/search?term=<%= searchTerm %>&page=1&sortOrder=highToLow">
                          High to Low
                      </a>
                      </li>
                    </ul>
                    <%}%>
                </div>
              </div>

            </div>
          </div>
          <%if (products.length>0){%>
          <% if (!catId) { %>

          <div class="col-lg-9 col-md-9 col-sm-9 filterProduct ">
            <div class="row">
              <% products.forEach((product) => { %>
              <div class="col-lg-4 col-md-6 col-sm-6">
                <div class="product__item">
                  <div
                    class="product__item__pic set-bg"
                    data-setbg="/assets/uploads/<%= product.productImages[0] %>"
                  >
                    <div class="label new">New</div>
                    <ul class="product__hover">
                      <li>
                        <a href="/product/<%= product._id %>" 
                          ><span class="arrow_expand p-2"></span
                        ></a>
                      </li>

                    <% if (wishlist && Array.isArray(wishlist.products) &&
                      wishlist.products.includes(product._id)) { %>
                      <li>
                        <a
                          href="/addToWishlist/<%= product._id %>?addedToWishlist=false"
                        >
                          <span
                            ><img
                              
                              src="/img/filled-like.png"
                              alt=""
                          /></span>
                        </a>
                      </li>
                      <% } else { %>
                      <li>
                        <a
                          href="/addToWishlist/<%= product._id %>?addedToWishlist=true"
                          data-productid="<%= product._id %>"
                        >
                          <span
                            ><img
                              
                              src="/img/unfilled-like.png"
                              alt=""
                          /></span>
                        </a>
                      </li>
                      <% } %> 
                      <% if (product.quantity > 0) { %>
                         <% let productInCart = false; %>
                          <% if (cart) { %> 
                          <% cart.item.forEach(cartItem => { %> 
                            <% if(cartItem.product.toString() === product._id.toString()) {
                      %> <% productInCart = true; %> <% } %> <% }); %> <% } %>
                      <% if (productInCart) { %>
                      <span class="cart__btn "
                        ><a href="/cart">Go to Cart</a></span
                      >
                      <% } else { %>
                      <li>
                        <a href="/addToCart/<%= product._id %>" class="cart-btn "
                          ><span class="icon_bag_alt "></span
                        ></a>
                      </li>
                      <% } %> <% } else { %>
                      <li>
                        <span style="color: red; font-weight: bold"
                          >Currently Unavailable</span
                        >
                      </li>
                      <% } %>
                    </ul>
                  </div>
                  <div class="product__item__text">
                    <h6>
                      <a href="/product/<%= product._id %>"
                        ><%= product.productName %></a
                      >
                    </h6>
                    <div class="rating">
                   
                    </div>
                   <% if (product.reducedPrice) { %>
                    <div class="product__price redd">
                      Rs. <%= product.reducedPrice %> <span> Rs. <%= product.price %></span>
                    </div>
                  <% } else if (product.offerPrice) { %>
                    <div class="product__price redd">
                      Rs. <%= product.offerPrice %><span> Rs. <%= product.price %></span>
                    </div>
                  <% } else { %>
                    <div class="product__price">
                      Rs. <%= product.price %>
                    </div>
                  <% } %>


                  </div>
                </div>
              </div>
              <% }); %>
            </div>
          </div>
          <% } else { %>

          <div class="col-lg-9 col-md-9">
            <div class="row">
              <% products.forEach((product) => { %>                
              <div class="col-lg-4 col-md-6">
                <div class="product__item">
                  <div
                    class="product__item__pic set-bg"
                    data-setbg="/assets/uploads/<%= product.productImages[0] %>"
                  >
                    <div class="label new">New</div>
                    <ul class="product__hover">
                      <li class="p-2">
                        <a href="/product/<%=product._id %>"
                          ><span class="arrow_expand"></span
                        ></a>
                      </li>

                      <% if (wishlist && Array.isArray(wishlist.products) &&
                      wishlist.products.includes(product._id)) { %>
                      <li>
                        <a
                          href="/addToWishlist/<%= product._id %>?addedToWishlist=false"
                        >
                          <span
                            ><img 
                             
                              src="/img/filled-like.png"
                              alt=""
                          /></span>
                        </a>
                      </li>
                      <% } else { %>
                      <li>
                        <a
                          href="/addToWishlist/<%= product._id %>?addedToWishlist=true"
                          data-productid="<%= product._id %>"
                        >
                          <span
                            ><img  
                              
                              src="/img/unfilled-like.png"
                              alt=""
                          /></span>
                        </a>
                      </li>
                      <% } %> <% if (product.quantity > 0) { %> <% let
                      productInCart = false; %> <% if (cart) { %> <%
                      cart.item.forEach(cartItem => { %> <% if
                      (cartItem.product.toString() === product._id.toString()) {
                      %> <% productInCart = true; %> <% } %> <% }); %> <% } %>
                      <% if (productInCart) { %>
                      <span class="cart__btn"
                        ><a href="/cart">Go to Cart</a></span
                      >
                      <% } else { %>
                      <li>
                        <a href="/addToCart/<%= product._id %>" class="cart-btn"
                          ><span class="icon_bag_alt"></span
                        ></a>
                      </li>
                      <% } %> <% } else { %>
                      <li>
                        <span style="color: red; font-weight: bold"
                          >Currently Unavailable</span
                        >
                      </li>
                      <% } %>
                    </ul>
                  </div>
                  <div class="product__item__text">
                    <h6>
                      <a href="/product/<%= product._id %>"
                        ><%= product.productName %></a
                      >
                    </h6>
                    <div class="rating">
                
                    </div>
                    <% if (product.reducedPrice) { %>
                      <div class="product__price redd">
                        Rs. <%= product.reducedPrice %> <span> Rs. <%= product.price %></span>
                      </div>
                    <% } else if (product.offerPrice) { %>
                      <div class="product__price redd">
                        Rs. <%= product.offerPrice %><span> Rs. <%= product.price %></span>
                      </div>
                    <% } else { %>
                      <div class="product__price">
                        Rs. <%= product.price %>
                      </div>
                    <% } %>



                  </div>
                </div>
              </div>

              <% }); %>
            </div>
          </div>

          <% } %>
          <%}else {%>
            <div>No Matched Products Found!!</div>
            <%}%>
        </div>
      </div>      

      <div id="pagination" class="col-lg-12 text-center">
  <div class="pagination__option">
    <% for (let i = 1; i <= pagination.totalPages; i++) { %>
      <% if (i === pagination.currentPage) { %>
        <span class="current"><%= i %></span>
      <% } else { %>
        <a href="?page=<%= i %>&sortOrder=<%= sortOrder %>"><%= i %></a>
      <% } %>
    <% } %>

    <% if (pagination.currentPage < pagination.totalPages) { %>
      <a href="?page=<%= pagination.currentPage + 1 %>&sortOrder=<%= sortOrder %>"><span class="arrow_right_alt"></span></a>
    <% } else { %>
      <span class="disabled"><span class="arrow_right_alt"></span></span>
    <% } %>
  </div>
</div>

   

    <div class="instagram">
      <div class="container">
        <div class="row">
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-1.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-2.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-3.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-4.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-5.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
          <div class="col-lg-2 col-md-4 col-sm-4 p-0">
            <div
              class="instagram__item set-bg"
              data-setbg="/img/instagram/insta-6.jpg"
            >
              <div class="instagram__text">
                <i class="fa fa-instagram"></i>
                <a href="#">@ ashion_shop</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <script>
  function toggleSidebar() {
    const sidebar = document.querySelector(".shop__sidebar");
    sidebar.style.display =
      sidebar.style.display === "none" || sidebar.style.display === ""
        ? "block"
        : "none";
  }
  


</script>
<script src="/js/search.js"></script>
  <%- include('../partials/footer.ejs')%>
</html>
